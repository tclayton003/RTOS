

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.4.3.6. The Protocol Stack &mdash; A3200 Command and Management SDK 2.12.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="A3200 Command and Management SDK 2.12.0 documentation" href="../../../../../index.html"/>
        <link rel="up" title="3.4.3. CubeSat Space Protocol" href="libcsp.html"/>
        <link rel="next" title="3.4.3.7. Network Topology" href="topology.html"/>
        <link rel="prev" title="3.4.3.5. How CSP uses memory" href="memory.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../doc/index.html" class="icon icon-home"> A3200 Command and Management SDK
          

          
          </a>

          
            
            
              <div class="version">
                2.12.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/a3200-sdk/a3200-sdk.html">1. A3200 SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/product_interfaces.html">2. Product Interfaces</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../doc/libraries.html">3. Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../liba3200/doc/liba3200.html">3.1. A3200 (liba3200)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../liba3200dock/doc/liba3200dock.html">3.2. A3200 Dock (liba3200dock)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libasf/doc/libasf.html">3.3. ASF (libasf)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../doc/libgscsp.html">3.4. GomSpace CSP (libgscsp)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../doc/introduction.html">3.4.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../doc/commands.html">3.4.2. Commands</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="libcsp.html">3.4.3. CubeSat Space Protocol</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../README.html">3.4.3.1. The Cubesat Space Protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="history.html">3.4.3.2. History</a></li>
<li class="toctree-l4"><a class="reference internal" href="structure.html">3.4.3.3. Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="basic.html">3.4.3.4. The basics of CSP</a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html">3.4.3.5. How CSP uses memory</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">3.4.3.6. The Protocol Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="topology.html">3.4.3.7. Network Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="mtu.html">3.4.3.8. Maximum Transfer Unit</a></li>
<li class="toctree-l4"><a class="reference internal" href="example.html">3.4.3.9. Client and server example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libembed/doc/libembed.html">3.5. Embed (libembed)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libemul/doc/libemul.html">3.6. Emulation (libemul)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libfp/doc/libfp.html">3.7. Flight Planner (libfp)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libftp/doc/libftp.html">3.8. FTP (libftp)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libgosh/doc/libgosh.html">3.9. GOSH (libgosh)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libgssb/doc/libgssb.html">3.10. GomSpace Sensor Bus (libgssb)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libhk/doc/libhk.html">3.11. Housekeeping (libhk)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libjson/doc/libjson.html">3.12. JSON parser (libjson)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../liblog/doc/liblog.html">3.13. Log (liblog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libnanopb/doc/libnanopb.html">3.14. Nano Protobuf (libnanopb)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libparam/doc/libparam.html">3.15. Parameter System (libparam)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../librgosh/doc/librgosh.html">3.16. Remote GOSH (librgosh)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libstorage/doc/libstorage.html">3.17. Storage (libstorage)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libthirdparty/doc/libthirdparty.html">3.18. Thirdparty (libthirdparty)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../libutil/doc/libutil.html">3.19. Utility (libutil)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/tools.html">4. Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/appendix/appendix.html">5. Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/zrefs.html">6. Bibliography</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../../doc/index.html">A3200 Command and Management SDK</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../doc/index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../../../doc/libraries.html">3. Libraries</a> &raquo;</li>
      
          <li><a href="../../../doc/libgscsp.html">3.4. GomSpace CSP (libgscsp)</a> &raquo;</li>
      
          <li><a href="libcsp.html">3.4.3. CubeSat Space Protocol</a> &raquo;</li>
      
    <li>3.4.3.6. The Protocol Stack</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-protocol-stack">
<h1>3.4.3.6. The Protocol Stack<a class="headerlink" href="#the-protocol-stack" title="Permalink to this headline">¶</a></h1>
<p>The CSP protocol stack includes functionality on all layers of the TCP/IP model:</p>
<div class="section" id="layer-1-drivers">
<span id="layer1"></span><h2>3.4.3.6.1. Layer 1: Drivers<a class="headerlink" href="#layer-1-drivers" title="Permalink to this headline">¶</a></h2>
<p>CSP is not designed for any specific processor or hardware peripheral, but yet these drivers are required in order to work. The intention of LibCSP is not to provide CAN, I2C or UART drivers for all platforms, however some drivers has only been included for some specific platforms. If you do not find your driver supported, it is quite simple to add a driver that conforms to the CSP interface.
For good stability and performance interrupt driven drivers are preferred in favor of polled drivers. Where applicable also DMA usage is recommended.</p>
</div>
<div class="section" id="layer-2-mac-interfaces">
<span id="layer2"></span><h2>3.4.3.6.2. Layer 2: MAC interfaces<a class="headerlink" href="#layer-2-mac-interfaces" title="Permalink to this headline">¶</a></h2>
<p>CSP has interfaces for I2C, CAN, RS232 (KISS) and Loopback. The layer 2 protocol software defines a frame-format that is suitable for the media. CSP can be easily extended with implementations for even more links. For example a radio-link and IP-networks. The file <cite>csp_interface.h</cite> declares the rx and tx functions needed in order to define a network interface in CSP. During initialisation of CSP each interface will be inserted into a linked list of interfaces that is available to the router. In cases where link-layer addresses are required, such as I2C, the routing table supports specifying a <cite>via</cite> link-layer address directly. This avoids the need to implement an address resolution protocol to translate CSP addresses to I2C addresses.</p>
</div>
<div class="section" id="layer-3-network-router">
<h2>3.4.3.6.3. Layer 3: Network Router<a class="headerlink" href="#layer-3-network-router" title="Permalink to this headline">¶</a></h2>
<p>The router core is the backbone of the CSP implementation. The router works by looking at a 32-bit CSP header which contains the destination and source address together with port numbers for the connection. The router supports both local destination and forwarding to an external destination. Messages will never exit the router on the same interface that they arrives at, this concept is called split horizon, and helps prevent routing loops.</p>
<p>The main purpose of the router is to accept incoming packets and deliver them to the right message queue. Therefore, in order to listen on a port-number on the network, a task must create a socket and call the accept() call. This will make the task block and wait for incoming traffic, just like a web-server or similar. When an incoming connection is opened, the task is woken. Depending on the task-priority, the task can even preempt another task and start execution immediately.</p>
<p>There is no routing protocol for automatic route discovery, all routing tables are pre-programmed into the subsystems. The table itself contains a separate route to each of the possible 32 nodes in the network and the additional default route. This means that the overall topology must be decided before putting sub-systems together, as explained in the <a class="reference internal" href="topology.html#topology"><span class="std std-ref">Network Topology</span></a> section. However CSP has an extension on port zero CMP (CSP management protocol), which allows for over-the-network routing table configuration. This has the advantage that default routes could be changed if for example the primary radio fails, and the secondary should be used instead.</p>
</div>
<div class="section" id="layer-4-transport-layer">
<span id="layer4"></span><h2>3.4.3.6.4. Layer 4: Transport Layer<a class="headerlink" href="#layer-4-transport-layer" title="Permalink to this headline">¶</a></h2>
<p>LibCSP implements two different Transport Layer protocols, they are called UDP (unreliable datagram protocol) and RDP (reliable datagram protocol). The name UDP has not been chosen to be an exact replica of the UDP (user datagram protocol) known from the TCP/IP model, but they have certain similarities.</p>
<p>The most important thing to notice is that CSP is entirely a datagram service. There is no stream based service like TCP. A datagram is a defined block of data with a specified size and structure. This block enters the transport layer as a single datagram and exits the transport layer in the other end as a single datagram. CSP preserves this structure all the way to the physical layer for I2C, KISS and Loopback interfaces. The CAN-bus interface has to fragment the datagram into CAN-frames of 8 bytes, however only a fully completed datagram will arrive at the receiver.</p>
<div class="section" id="udp">
<h3>3.4.3.6.4.1. UDP<a class="headerlink" href="#udp" title="Permalink to this headline">¶</a></h3>
<p>UDP uses a simple transmission model without implicit hand-shaking dialogues for guaranteeing reliability, ordering, or data integrity. Thus, UDP provides an unreliable service and datagrams may arrive out of order, appear duplicated, or go missing without notice. UDP assumes that error checking and correction is either not necessary or performed in the application, avoiding the overhead of such processing at the network interface level. Time-sensitive applications often use UDP because dropping packets is preferable to waiting for delayed packets, which may not be an option in a real-time system.</p>
<p>UDP is very practical to implement request/reply based communication where a single packet forms the request and a single packet forms the reply. In this case a typical request and wait protocol is used between the client and server, which will simply return an error if a reply is not received within a specified time limit. An error would normally lead to a retransmission of the request from the user or operator which sent the request.</p>
<p>While UDP is very simple, it also has some limitations. Normally a human in the loop is a good thing when operating the satellite over UDP. But when it comes to larger file transfers, the human becomes the bottleneck. When a high-speed file transfer is initiated data acknowledgment should be done automatically in order to speed up the transfer. This is where the RDP protocol can help.</p>
</div>
<div class="section" id="rdp">
<h3>3.4.3.6.4.2. RDP<a class="headerlink" href="#rdp" title="Permalink to this headline">¶</a></h3>
<p>CSP provides a transport layer extension called RDP (reliable datagram protocol) which is an implementation of RFC908 and RFC1151. RDP provides a few additional features:</p>
<blockquote>
<div><ul class="simple">
<li>Three-way handshake</li>
<li>Flow Control</li>
<li>Data-buffering</li>
<li>Packet re-ordering</li>
<li>Retransmission</li>
<li>Windowing</li>
<li>Extended Acknowledgment</li>
</ul>
</div></blockquote>
<p>For more information on this, please refer to RFC908 and RFC1151.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="topology.html" class="btn btn-neutral float-right" title="3.4.3.7. Network Topology" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="memory.html" class="btn btn-neutral" title="3.4.3.5. How CSP uses memory" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 GomSpace A/S..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'2.12.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>